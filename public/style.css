/* ── Reset & variables ───────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sidebar-w: 260px;
  --toc-w: 220px;
  --topbar-h: 48px;
  --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', Consolas, monospace;
  --font-size: 15px;
  --radius: 6px;
  --transition: 0.15s ease;
}

/* Light theme */
[data-theme="light"] {
  --bg: #ffffff;
  --bg-sidebar: #f6f8fa;
  --bg-hover: #eaeef2;
  --bg-active: #dde4ed;
  --bg-code: #f6f8fa;
  --border: #d0d7de;
  --text: #1f2328;
  --text-muted: #656d76;
  --text-sidebar: #24292f;
  --link: #0969da;
  --accent: #0969da;
  --heading: #1f2328;
  --blockquote-border: #d0d7de;
  --blockquote-bg: #f6f8fa;
  --table-border: #d0d7de;
  --table-row-alt: #f6f8fa;
  --badge-bg: #eaeef2;
  --scrollbar: #d0d7de;
}

/* Dark theme */
[data-theme="dark"] {
  --bg: #0d1117;
  --bg-sidebar: #161b22;
  --bg-hover: #1c2128;
  --bg-active: #22272e;
  --bg-code: #161b22;
  --border: #30363d;
  --text: #e6edf3;
  --text-muted: #8b949e;
  --text-sidebar: #cdd9e5;
  --link: #58a6ff;
  --accent: #58a6ff;
  --heading: #e6edf3;
  --blockquote-border: #3d444d;
  --blockquote-bg: #161b22;
  --table-border: #3d444d;
  --table-row-alt: #161b22;
  --badge-bg: #21262d;
  --scrollbar: #30363d;
}

/* ── Layout ──────────────────────────────────────────────────────────────── */
html, body, #app { height: 100%; }
body { font-family: var(--font-sans); font-size: var(--font-size); background: var(--bg); color: var(--text); overflow: hidden; }

#app {
  display: flex;
  height: 100vh;
}

/* ── Sidebar ─────────────────────────────────────────────────────────────── */
#sidebar {
  width: var(--sidebar-w);
  min-width: var(--sidebar-w);
  background: var(--bg-sidebar);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: width var(--transition), min-width var(--transition);
}

#sidebar.collapsed {
  width: 0;
  min-width: 0;
  border-right: none;
}

#sidebar-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 14px;
  border-bottom: 1px solid var(--border);
  min-height: var(--topbar-h);
  flex-shrink: 0;
}

.sidebar-logo { font-size: 18px; }
.sidebar-title { font-size: 14px; font-weight: 600; color: var(--text-sidebar); flex: 1; }

#theme-toggle {
  background: none; border: none; cursor: pointer; font-size: 16px;
  padding: 2px 4px; border-radius: var(--radius); opacity: 0.7;
  transition: opacity var(--transition);
}
#theme-toggle:hover { opacity: 1; }

#sidebar-search {
  padding: 8px 10px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

#search-input {
  width: 100%; padding: 5px 8px;
  background: var(--bg); border: 1px solid var(--border);
  border-radius: var(--radius); color: var(--text);
  font-size: 13px; outline: none;
  transition: border-color var(--transition);
}
#search-input:focus { border-color: var(--accent); }

#sidebar-projects {
  flex: 1; overflow-y: auto; padding: 8px 0;
  scrollbar-width: thin; scrollbar-color: var(--scrollbar) transparent;
}

/* ── Project sections ────────────────────────────────────────────────────── */
.project-section { margin-bottom: 4px; }

.project-header {
  display: flex; align-items: center; gap: 6px;
  padding: 6px 14px; cursor: pointer;
  font-size: 12px; font-weight: 600; letter-spacing: 0.05em;
  text-transform: uppercase; color: var(--text-muted);
  user-select: none;
  transition: color var(--transition);
}
.project-header:hover { color: var(--text-sidebar); }

.project-chevron {
  display: inline-block; font-size: 10px;
  transition: transform var(--transition);
}
.project-section.open .project-chevron { transform: rotate(90deg); }

.project-tree { display: none; }
.project-section.open .project-tree { display: block; }

/* ── Tree nodes ──────────────────────────────────────────────────────────── */
.tree-folder { }

.tree-folder-label {
  display: flex; align-items: center; gap: 5px;
  padding: 4px 14px 4px 20px;
  cursor: pointer; font-size: 13px; color: var(--text-muted);
  user-select: none;
  transition: color var(--transition), background var(--transition);
}
.tree-folder-label:hover { color: var(--text-sidebar); background: var(--bg-hover); }

.folder-chevron {
  display: inline-block; font-size: 9px;
  transition: transform var(--transition);
}
.tree-folder.open .folder-chevron { transform: rotate(90deg); }

.tree-children { display: none; }
.tree-folder.open .tree-children { display: block; }

.tree-file {
  padding: 4px 14px 4px 28px;
  cursor: pointer; font-size: 13px;
  color: var(--text-sidebar); border-radius: 0;
  transition: background var(--transition), color var(--transition);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.tree-file:hover { background: var(--bg-hover); }
.tree-file.active { background: var(--bg-active); color: var(--accent); font-weight: 500; }
.tree-file.hidden { display: none; }

/* Indent nested folders */
.tree-children .tree-file { padding-left: 40px; }
.tree-children .tree-folder-label { padding-left: 32px; }
.tree-children .tree-children .tree-file { padding-left: 52px; }
.tree-children .tree-children .tree-folder-label { padding-left: 44px; }
.tree-children .tree-children .tree-children .tree-file { padding-left: 64px; }

.sidebar-loading { padding: 16px 14px; color: var(--text-muted); font-size: 13px; }

/* ── Main area ───────────────────────────────────────────────────────────── */
#main {
  flex: 1; display: flex; flex-direction: column; overflow: hidden;
}

#topbar {
  display: flex; align-items: center; gap: 10px;
  padding: 0 16px; height: var(--topbar-h);
  border-bottom: 1px solid var(--border);
  background: var(--bg); flex-shrink: 0;
}

#sidebar-toggle {
  background: none; border: none; cursor: pointer;
  font-size: 18px; color: var(--text-muted); padding: 4px;
  border-radius: var(--radius); line-height: 1;
  transition: color var(--transition);
}
#sidebar-toggle:hover { color: var(--text); }

#breadcrumb {
  flex: 1; font-size: 13px; color: var(--text-muted);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.bc-project { font-weight: 600; color: var(--text); }
.bc-sep { margin: 0 4px; }
.bc-part { color: var(--text-muted); }
.bc-part.last { color: var(--text); }

#connection-status {
  width: 8px; height: 8px; border-radius: 50%;
  background: #888; flex-shrink: 0;
  transition: background 0.3s;
}
#connection-status.connected { background: #3fb950; }
#connection-status.disconnected { background: #f85149; }

/* ── Content wrapper ─────────────────────────────────────────────────────── */
#content-wrapper {
  flex: 1; display: flex; overflow: hidden;
}

#content {
  flex: 1; overflow-y: auto; padding: 40px 48px;
  max-width: 900px;
  scrollbar-width: thin; scrollbar-color: var(--scrollbar) transparent;
}

/* ── TOC panel ───────────────────────────────────────────────────────────── */
#toc-panel {
  width: var(--toc-w); min-width: var(--toc-w);
  border-left: 1px solid var(--border);
  overflow-y: auto; padding: 40px 0 40px 16px;
  display: none; flex-direction: column;
  scrollbar-width: thin; scrollbar-color: var(--scrollbar) transparent;
}
#toc-panel.visible { display: flex; }

#toc-header {
  font-size: 12px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.05em;
  color: var(--text-muted); margin-bottom: 10px;
}

#toc a {
  display: block; font-size: 13px; color: var(--text-muted);
  text-decoration: none; padding: 3px 0; line-height: 1.4;
  transition: color var(--transition);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
#toc a:hover { color: var(--accent); }
#toc a.active { color: var(--accent); }
#toc .toc-h2 { padding-left: 0; }
#toc .toc-h3 { padding-left: 12px; font-size: 12px; }

/* ── Markdown content ────────────────────────────────────────────────────── */
#content h1, #content h2, #content h3,
#content h4, #content h5, #content h6 {
  color: var(--heading);
  line-height: 1.3; margin: 1.5em 0 0.6em;
  font-weight: 600;
}
#content h1 { font-size: 2em; border-bottom: 1px solid var(--border); padding-bottom: 0.3em; margin-top: 0; }
#content h2 { font-size: 1.5em; border-bottom: 1px solid var(--border); padding-bottom: 0.3em; }
#content h3 { font-size: 1.25em; }
#content h4 { font-size: 1em; }

#content .heading-anchor { color: inherit; text-decoration: none; }
#content .heading-anchor:hover::after {
  content: ' #'; color: var(--text-muted); font-weight: 400;
}

#content p { line-height: 1.7; margin: 0.8em 0; }

#content a { color: var(--link); text-decoration: none; }
#content a:hover { text-decoration: underline; }

#content ul, #content ol { padding-left: 2em; margin: 0.8em 0; }
#content li { line-height: 1.7; margin: 0.2em 0; }
#content li > ul, #content li > ol { margin: 0; }

/* Checkboxes (task lists) */
#content input[type="checkbox"] {
  margin-right: 6px; accent-color: var(--accent);
}

#content blockquote {
  border-left: 4px solid var(--blockquote-border);
  background: var(--blockquote-bg);
  padding: 12px 16px; margin: 1em 0;
  border-radius: 0 var(--radius) var(--radius) 0;
  color: var(--text-muted);
}
#content blockquote p { margin: 0; }

#content hr {
  border: none; border-top: 1px solid var(--border); margin: 2em 0;
}

/* Inline code */
#content :not(pre) > code {
  font-family: var(--font-mono); font-size: 0.875em;
  background: var(--bg-code); color: var(--text);
  padding: 2px 6px; border-radius: 4px;
  border: 1px solid var(--border);
}

/* Shiki code blocks */
#content pre {
  margin: 1.2em 0; border-radius: var(--radius);
  overflow-x: auto; border: 1px solid var(--border);
}
#content pre > code {
  font-family: var(--font-mono); font-size: 0.875em;
  display: block; padding: 16px 20px;
  background: none; border: none;
}

/* Shiki dual-theme: show correct block by theme */
[data-theme="dark"]  .shiki.github-light { display: none; }
[data-theme="light"] .shiki.github-dark  { display: none; }
[data-theme="dark"]  .shiki.github-dark  { display: block; }
[data-theme="light"] .shiki.github-light { display: block; }

/* Override shiki container */
#content .shiki {
  margin: 0; border-radius: var(--radius);
  padding: 16px 20px; overflow-x: auto;
  font-family: var(--font-mono); font-size: 0.875em;
  line-height: 1.6;
}

/* Tables */
#content table {
  border-collapse: collapse; width: 100%;
  margin: 1em 0; font-size: 0.95em;
  display: block; overflow-x: auto;
}
#content th, #content td {
  border: 1px solid var(--table-border);
  padding: 8px 12px; text-align: left;
}
#content th { background: var(--bg-code); font-weight: 600; }
#content tr:nth-child(even) td { background: var(--table-row-alt); }

/* Images */
#content img { max-width: 100%; border-radius: var(--radius); }

/* Mermaid */
#content .mermaid {
  text-align: center; padding: 24px;
  background: var(--bg-code); border: 1px solid var(--border);
  border-radius: var(--radius); margin: 1em 0; overflow-x: auto;
}

/* ── States ──────────────────────────────────────────────────────────────── */
.welcome { max-width: 520px; }
.welcome h1 { margin-top: 0 !important; }
.welcome p { color: var(--text-muted); }

.loading { color: var(--text-muted); padding: 24px 0; font-size: 14px; }
.error-msg { color: #f85149; padding: 16px 0; font-size: 14px; }

/* ── Scrollbars (WebKit) ─────────────────────────────────────────────────── */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 3px; }
